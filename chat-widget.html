<!-- Add this before closing </body> tag - Updated to handle JSON response -->
<script>
    const chatForm = document.getElementById('chatForm');
    const messageInput = document.getElementById('messageInput');
    const chatMessages = document.getElementById('chatMessages');
    const loadingSpinner = document.getElementById('loadingSpinner');
    const sendButton = document.getElementById('sendButton');

    chatForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const message = messageInput.value.trim();
        if (!message) return;

        // Add user message
        addMessage(message, 'user');
        messageInput.value = '';
        
        // Show loading spinner
        loadingSpinner.style.display = 'block';
        sendButton.disabled = true;

        try {
            const response = await fetch('https://n8n-18mf.onrender.com/webhook/da19cf96-3a4d-4569-a7fa-b8b1c2d82711/chat', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ message })
            });

            const text = await response.text();
            
            // Extract the actual message from the JSON response
            try {
                const jsonResponse = JSON.parse(text);
                // Display just the text content, not the raw JSON
                const cleanText = jsonResponse.content || jsonResponse.message || jsonResponse.response || text;
                addMessage(cleanText, 'bot');
            } catch (e) {
                // If JSON parsing fails, show the raw text
                addMessage(text, 'bot');
            }
            
        } catch (error) {
            console.error('Error:', error);
            addMessage('Sorry, something went wrong. Please try again.', 'bot');
        } finally {
            loadingSpinner.style.display = 'none';
            sendButton.disabled = false;
        }
    });

    function addMessage(content, type) {
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${type}-message`;
        messageDiv.textContent = content;
        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }
</script>
